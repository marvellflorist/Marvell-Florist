<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marvell Florist</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@500;600;700&family=Fraunces:opsz,wght@9..144,300;9..144,400&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html {
  scroll-behavior: smooth;
  scroll-snap-type: y mandatory;
  background: #0b0908;
  overscroll-behavior-y: none;
}
body {
  font-family: "Fraunces", serif;
  background: linear-gradient(180deg, #f5efe6 0%, #f2eadf 100%);
  color: #fff;
  overflow-x: hidden;
  overscroll-behavior-y: none;
}
body.gallery-open section:not(#gallery) {
  filter: saturate(0.9) brightness(0.95) blur(0.8px);
}
body.gallery-open section {
  transition: filter 0.35s ease;
}
h1, h2, h3, h4, h5, h6 {
  font-family: "Inter Tight", sans-serif;
}

header {
  position: fixed;
  top: 0;
  width: 100%;
  padding: 24px 48px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 50;
}
header img { height: 36px; }
nav a {
  font-family: "Inter Tight", sans-serif;
  margin-left: 28px;
  font-size: 13px;
  letter-spacing: 0.4px;
  color: #fff;
  text-decoration: none;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.35);
}
.brand-pinned-title {
  position: fixed;
  top: 28px;
  left: 50%;
  transform: translateX(-50%) translateY(-8px) scale(0.92);
  z-index: 45;
  font-family: "Inter Tight", sans-serif;
  font-size: clamp(16px, 1.8vw, 24px);
  font-weight: 700;
  letter-spacing: 0.01em;
  line-height: 1;
  color: #f4eee4;
  text-shadow: none;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.38s ease, transform 0.46s cubic-bezier(0.22, 1, 0.36, 1);
  display: block;
}
body.home-title-pinned .brand-pinned-title {
  opacity: 1;
  transform: translateX(-50%) translateY(0) scale(1);
  text-shadow: none;
}
#home .section-content h1 {
  transition: transform 0.3s ease;
}

section {
  position: relative;
  min-height: 160vh;
  overflow: hidden;
  scroll-snap-align: start;
}

.section-content {
  position: sticky;
  top: 50vh;
  transform: translateY(-50%);
  z-index: 20;
  max-width: 980px;
  margin: 0 auto;
  text-align: center;
  padding: 0 6vw;
}
.section-content h1 {
  font-family: "Inter Tight", sans-serif;
  font-size: 46px;
  margin-bottom: 14px;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.35);
}
.section-content p {
  font-size: 18px;
  line-height: 1.65;
}

.layer-bg {
  position: absolute;
  inset: -30%;
  background-size: cover;
  background-position: center;
  will-change: transform;
}
.layer-fg {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 160%;
  height: 300%;
  transform: translate(-50%, -50%);
  background-repeat: no-repeat;
  background-size: contain;
  background-position: center;
  will-change: transform;
  pointer-events: none;
}

#home .layer-bg { background-image: url("assets/scene1-bg.png"); }
#home .layer-fg {
  background-image: url("assets/scene1-fg.png");
  top: 52%;
  background-position: center top;
  width: 160%;
  height: 300%;
}

#gallery {
  min-height: auto;
  color: #2f2a25;
  background: none;
  isolation: isolate;
}
#gallery::before {
  content: "";
  position: absolute;
  inset: 0;
  background: url("assets/scene3.jpg") center / cover no-repeat fixed;
  filter: saturate(0.92) contrast(0.94) blur(0.6px);
  transform: scale(1.01);
  z-index: 0;
}
#gallery::after {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(247, 241, 231, 0.18);
  z-index: 1;
}
#gallery .section-content {
  position: relative;
  z-index: 2;
  top: auto;
  transform: none;
  max-width: 1160px;
  text-align: left;
  padding-top: 130px;
  padding-bottom: 120px;
}
#gallery h1,
#gallery p {
  color: #2f2a25;
  text-shadow: none;
}
.gallery-lead {
  max-width: 760px;
  color: #453f35;
}
.gallery-list {
  margin-top: 34px;
  display: grid;
  gap: 24px;
}
.gallery-category {
  position: relative;
  border-radius: 18px;
  overflow: hidden;
  background: rgba(246, 238, 225, 0.54);
  border: 1px solid rgba(71, 60, 45, 0.12);
  box-shadow: 0 16px 34px rgba(45, 34, 24, 0.12);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  transition: box-shadow 0.36s ease;
}
.gallery-category.is-open {
  box-shadow: 0 18px 36px rgba(45, 34, 24, 0.14);
}
.category-toggle {
  width: 100%;
  border: 0;
  background: none;
  color: inherit;
  cursor: pointer;
  text-align: left;
  padding: 0;
  font: inherit;
  display: block;
}
.category-toggle:focus-visible {
  outline: 2px solid rgba(56, 46, 35, 0.45);
  outline-offset: -2px;
}
.category-cover {
  position: relative;
  height: clamp(280px, 33vw, 390px);
}
.category-cover img {
  width: 100%;
  display: block;
  height: 100%;
  object-fit: cover;
  object-position: 50% 40%;
}
.category-cover::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  box-shadow: inset 0 0 36px rgba(0, 0, 0, 0.12);
}
.category-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: flex-start;
  gap: 8px;
  padding: 26px;
  background: linear-gradient(to top, rgba(21, 16, 12, 0.52) 0%, rgba(21, 16, 12, 0.14) 60%, rgba(21, 16, 12, 0.05) 100%);
  transition: background 0.3s ease;
}
.gallery-category:hover .category-overlay,
.gallery-category:focus-within .category-overlay {
  background: linear-gradient(to top, rgba(21, 16, 12, 0.58) 0%, rgba(21, 16, 12, 0.2) 64%, rgba(21, 16, 12, 0.08) 100%);
}
.category-title {
  font-family: "Inter Tight", sans-serif;
  color: #f5efe6;
  font-size: 28px;
  letter-spacing: 0.2px;
  text-align: left;
  text-shadow: 0 3px 16px rgba(0, 0, 0, 0.62);
}
.category-subtitle {
  color: rgba(245, 239, 230, 0.95);
  font-size: 14px;
  line-height: 1.5;
  max-width: 680px;
  text-shadow: 0 2px 12px rgba(0, 0, 0, 0.48);
}
#gallery .gallery-category .category-title {
  color: #f5efe6;
  text-shadow: 0 3px 16px rgba(0, 0, 0, 0.62);
}
#gallery .gallery-category .category-subtitle {
  color: rgba(245, 239, 230, 0.95);
  text-shadow: 0 2px 12px rgba(0, 0, 0, 0.48);
}
.category-expand-label {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-family: "Inter Tight", sans-serif;
  font-size: 12px;
  letter-spacing: 0.3px;
  text-transform: uppercase;
  background: #fff;
  color: #191816;
  padding: 10px 18px;
  border-radius: 999px;
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.24);
  transition: transform 0.14s cubic-bezier(0.2, 0.88, 0.28, 1), box-shadow 0.28s cubic-bezier(0.22, 1, 0.36, 1);
}
.gallery-category:hover .category-expand-label,
.gallery-category:focus-within .category-expand-label {
  transform: translateY(-1px) scale(1.008);
  box-shadow: 0 11px 22px rgba(0, 0, 0, 0.24);
}
.category-panel {
  position: relative;
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transition: max-height 0.54s ease-in-out, opacity 0.42s ease-in-out, padding 0.42s ease-in-out;
  padding: 0 30px;
}
.gallery-category.is-open .category-panel {
  opacity: 1;
  padding: 22px 30px 26px;
  overflow-y: auto;
  overscroll-behavior: auto;
}
.collection-heading {
  font-family: "Inter Tight", sans-serif;
  font-size: 30px;
  color: #2d2924;
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.45);
}
.collection-desc {
  margin-top: 10px;
  max-width: 760px;
  font-size: 15px;
  color: #4d4438;
  line-height: 1.55;
}
.masonry-grid {
  margin-top: 26px;
  column-count: 2;
  column-gap: 34px;
}
.collection-placeholder {
  break-inside: avoid;
  column-span: all;
  margin-bottom: 10px;
  padding: 24px 22px;
  border-radius: 14px;
  border: 1px dashed rgba(72, 59, 45, 0.34);
  background: rgba(245, 238, 227, 0.75);
  color: #4d4438;
  font-family: "Inter Tight", sans-serif;
  font-size: 14px;
  letter-spacing: 0.1px;
}
.masonry-item {
  break-inside: avoid;
  position: relative;
  margin-bottom: 34px;
  border-radius: 18px;
  overflow: hidden;
  background: #1e1e1e;
  box-shadow: 0 16px 34px rgba(30, 24, 18, 0.2);
  transition: transform 0.16s cubic-bezier(0.2, 0.88, 0.28, 1), box-shadow 0.3s cubic-bezier(0.22, 1, 0.36, 1);
}
.category-cover-placeholder {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(62, 46, 34, 0.55), rgba(38, 30, 22, 0.6));
}
.masonry-item img {
  width: 100%;
  display: block;
  height: auto;
  object-fit: cover;
  object-position: center 44%;
}
.design-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.46);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 14px;
  padding: 20px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s cubic-bezier(0.22, 1, 0.36, 1);
}
.masonry-item:hover .design-overlay,
.masonry-item:focus-within .design-overlay,
.masonry-item.is-active .design-overlay {
  opacity: 1;
  pointer-events: auto;
}
.design-title {
  font-family: "Inter Tight", sans-serif;
  color: #f5efe6;
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 0.3px;
  text-shadow: 0 2px 14px rgba(0, 0, 0, 0.6);
  position: relative;
  z-index: 1;
  text-align: center;
  opacity: 0;
  transform: translateY(6px);
  transition: opacity 0.3s ease, transform 0.3s ease;
}
#gallery .masonry-item .design-title {
  color: #f5efe6;
  text-shadow: 0 2px 14px rgba(0, 0, 0, 0.62);
}
.design-consult-btn {
  font-family: "Inter Tight", sans-serif;
  font-size: 12px;
  color: #1b1713;
  text-decoration: none;
  background: rgba(255, 255, 255, 0.96);
  border-radius: 999px;
  padding: 12px 26px;
  letter-spacing: 0.18px;
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.9);
  position: relative;
  z-index: 1;
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 0.2s cubic-bezier(0.2, 0.88, 0.28, 1), transform 0.2s cubic-bezier(0.2, 0.88, 0.28, 1), box-shadow 0.26s cubic-bezier(0.22, 1, 0.36, 1), background 0.18s ease;
}
.masonry-item:hover .design-title,
.masonry-item:focus-within .design-title,
.masonry-item.is-active .design-title,
.masonry-item:hover .design-consult-btn,
.masonry-item:focus-within .design-consult-btn,
.masonry-item.is-active .design-consult-btn {
  opacity: 1;
  transform: translateY(0);
}
.design-consult-btn:hover {
  background: #fff;
  box-shadow: 0 14px 30px rgba(0, 0, 0, 0.28);
}
.masonry-item:hover {
  transform: translateY(-1px) scale(1.008);
  box-shadow: 0 18px 32px rgba(17, 12, 8, 0.2);
}
.category-consult-wrap {
  margin-top: 16px;
  padding-top: 10px;
}
.category-consult-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-family: "Inter Tight", sans-serif;
  font-size: 12px;
  letter-spacing: 0.28px;
  text-transform: uppercase;
  text-decoration: none;
  color: #201b16;
  background: #fff;
  border: 1px solid rgba(42, 34, 27, 0.14);
  border-radius: 999px;
  padding: 12px 24px;
  box-shadow: 0 10px 22px rgba(26, 20, 15, 0.14);
  transition: transform 0.22s ease, box-shadow 0.22s ease;
}
.category-consult-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 14px 26px rgba(26, 20, 15, 0.2);
}
.gallery-category.is-open .category-panel::-webkit-scrollbar {
  width: 9px;
}
.gallery-category.is-open .category-panel::-webkit-scrollbar-thumb {
  background: rgba(73, 61, 47, 0.34);
  border-radius: 999px;
}
.gallery-category.is-open .category-panel::-webkit-scrollbar-track {
  background: rgba(73, 61, 47, 0.08);
}
.gallery-category.is-open .masonry-grid {
  padding-bottom: 18px;
}
.gallery-category.is-open .category-consult-wrap {
  padding-bottom: 10px;
}
.gallery-category .collection-heading,
.gallery-category .collection-desc,
.gallery-category .masonry-grid,
.gallery-category .category-consult-wrap {
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 0.34s ease, transform 0.34s ease;
}
.gallery-category.is-open .collection-heading,
.gallery-category.is-open .collection-desc,
.gallery-category.is-open .masonry-grid,
.gallery-category.is-open .category-consult-wrap {
  opacity: 1;
  transform: translateY(0);
}

#about {
  isolation: isolate;
}
#about .scene2-strip-bg {
  background-image: url("assets/scene2-bg.png");
}
#about .scene2-strip-bg,
#about .scene2-strip-fg {
  position: absolute;
  inset: 0;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center center;
  transform-origin: center;
  transform: none;
}
#about .scene2-strip-bg {
  z-index: 1;
  pointer-events: none;
}
#about .scene2-strip-bg::after {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(246, 232, 198, 0.18);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.34s ease-in-out;
}
#about.about-selected .scene2-strip-bg::after {
  opacity: 1;
}
#about .scene2-strip-fg {
  pointer-events: none;
}
#about .section-content {
  display: grid;
  place-items: center;
  z-index: 6;
  top: 50vh;
  transform: translateY(-50%);
  transition: top 0.56s ease-in-out, transform 0.56s ease-in-out;
  pointer-events: none;
}
#about.about-selected .section-content {
  top: 50vh;
  transform: translateY(-50%);
}
.about-content-inner {
  width: min(900px, 90vw);
  min-height: 38vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-end;
  text-align: right;
  pointer-events: auto;
}
.about-heading {
  font-family: "Inter Tight", sans-serif;
  font-size: clamp(102px, 12.2vw, 178px);
  font-weight: 700;
  letter-spacing: -0.01em;
  line-height: 0.82;
  color: #f4eee4;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.16);
  transform-origin: center top;
  transition: transform 0.56s ease-in-out, text-shadow 0.56s ease-in-out;
  margin-bottom: 10px;
}
#about.about-selected .about-heading {
  transform: translateY(-6px) scale(0.64);
  text-shadow: 0 8px 24px rgba(0, 0, 0, 0.18);
}
.about-slogan {
  margin: 0;
  max-width: 700px;
  font-family: "Fraunces", serif;
  font-size: 18px;
  line-height: 1.7;
  color: #efe7dc;
  opacity: 0.9;
  text-shadow: none;
  text-align: right;
  transition: opacity 0.42s ease-in-out, transform 0.42s ease-in-out;
}
.about-slogan-highlight {
  background: transparent;
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
  padding: 0;
}
#about.about-selected .about-slogan {
  opacity: 0;
  transform: translateY(-8px);
  pointer-events: none;
}
.about-bio-panel {
  margin-top: 18px;
  opacity: 0;
  transform: translateY(16px);
  transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
}
#about.about-selected .about-bio-panel {
  opacity: 1;
  transform: translateY(0);
}
.about-bio {
  display: none;
  max-width: 780px;
  margin: 0 auto;
  padding: 18px 22px;
  border-radius: 14px;
  background: rgba(25, 20, 16, 0.38);
  border: 1px solid rgba(244, 238, 228, 0.2);
  backdrop-filter: blur(2.5px);
  -webkit-backdrop-filter: blur(2.5px);
}
.about-bio.is-active {
  display: block;
}
.about-bio h3 {
  font-family: "Inter Tight", sans-serif;
  font-size: 20px;
  margin-bottom: 8px;
  color: #f4eee4;
}
.about-bio p {
  margin: 0;
  font-size: 17px;
  line-height: 1.75;
  color: rgba(244, 238, 228, 0.94);
}
#about .scene2-strip-fg1 { z-index: 2; }
#about .scene2-strip-fg2 { z-index: 3; }
#about .scene2-strip-fg3 { z-index: 4; }

#about .scene2-strip-fg-image {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
  pointer-events: auto;
  cursor: pointer;
  transform: translateY(0);
  filter: brightness(1);
  opacity: 0.96;
  transition: transform 0.3s ease, filter 0.3s ease, opacity 0.4s ease;
}
#about .scene2-strip-fg-image:focus-visible {
  outline: 2px solid rgba(244, 238, 228, 0.75);
  outline-offset: -2px;
}
#about .scene2-strip-fg-image.is-pixel-hover,
#about .scene2-strip-fg-image:focus-visible {
  transform: translateY(-6px);
  filter: brightness(0.9);
}
#about.about-selected .scene2-strip-fg-image {
  opacity: 0.45;
}
#about.about-selected .scene2-strip-fg-image.is-active {
  opacity: 1;
}

#contact {
  position: relative;
  isolation: isolate;
  height: 220vh;
  min-height: 220vh;
  background: transparent;
  color: #fff;
}
#contact .parallax-container {
  position: absolute;
  inset: 0;
  overflow: hidden;
  z-index: 0;
}
#contact .contact-grid-layer {
  position: absolute;
  inset: 0;
  z-index: 2;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding-top: 64vh;
  pointer-events: none;
  transition: z-index 0s linear 0.74s;
}
#contact .contact-grid-layer.is-grid-elevated {
  z-index: 5;
  transition-delay: 0s;
}
#contact .layer-bg {
  background-image: url("assets/scene4-bg.PNG");
  z-index: 1;
}
#contact .layer-fg-curtain,
#contact .layer-fg1 {
  background-image: url("assets/scene4-fg1.PNG");
  z-index: 4;
}
#contact .layer-fg-people,
#contact .layer-fg2 {
  background-image: url("assets/scene4-fg2.PNG");
  z-index: 3;
}
#contact .scene4FG2::after {
  content: "";
  position: absolute;
  left: 50%;
  bottom: 4%;
  width: 52%;
  height: 12%;
  transform: translateX(-50%);
  background: radial-gradient(
    ellipse at center,
    rgba(0, 0, 0, 0.72) 0%,
    rgba(0, 0, 0, 0.38) 42%,
    rgba(0, 0, 0, 0.12) 66%,
    rgba(0, 0, 0, 0) 82%
  );
  filter: blur(14px);
  opacity: 1;
  z-index: 2;
  pointer-events: none;
}
#contact .layer-bg,
#contact .layer-fg-curtain,
#contact .layer-fg-people,
#contact .layer-fg1,
#contact .layer-fg2 {
  inset: 0;
  width: auto;
  height: auto;
  top: 0;
  left: 0;
  transform-origin: center center;
  transform: none;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}
#contact .layer-fg1 {
  background-position: left center;
}
#contact .section-content {
  position: absolute;
  inset: 0;
  z-index: 6;
  pointer-events: none;
  top: auto;
  transform: none;
  max-width: none;
  width: 100%;
  min-height: 100%;
  height: 100%;
  padding: 124px 7vw 88px;
  text-align: left;
}
.contact-layout {
  position: relative;
  width: min(1240px, 100%);
  margin: 0 auto;
  display: grid;
  grid-template-columns: minmax(280px, 430px) minmax(540px, 1fr);
  gap: 44px;
  align-items: start;
  opacity: 0;
  transform: translateY(18px);
  transition: opacity 0.82s ease, transform 0.82s cubic-bezier(0.22, 1, 0.36, 1);
}
#contact.is-visible .contact-layout {
  opacity: 1;
  transform: translateY(0);
}
.contact-intro {
  position: relative;
  z-index: 7;
  pointer-events: auto;
  align-self: start;
  padding-top: 8px;
}
#contact h1,
#contact p,
#contact a {
  color: #f4eee4;
}
#contact h1 {
  font-family: "Inter Tight", sans-serif;
  font-size: clamp(102px, 12.2vw, 178px);
  font-weight: 700;
  letter-spacing: -0.01em;
  line-height: 0.82;
  text-transform: none;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.16);
  margin-bottom: 16px;
  text-align: left;
}
.contact-slogan {
  margin: 0;
  max-width: 360px;
  font-family: "Fraunces", serif;
  font-size: 18px;
  line-height: 1.7;
  color: #efe7dc;
  opacity: 0.9;
  text-shadow: none;
  text-align: left;
}
.contact-slogan-highlight {
  background: transparent;
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
  padding: 0;
}
.contact-socials {
  position: relative;
  z-index: 2;
  width: min(72vw, 980px);
  max-width: 72vw;
  margin: 0;
  padding-right: 0;
  pointer-events: auto;
  filter: blur(2.4px);
  opacity: 0.86;
  transform: scale(0.992);
  transform-origin: center top;
  transition: filter 0.74s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.74s cubic-bezier(0.22, 1, 0.36, 1), transform 0.74s cubic-bezier(0.22, 1, 0.36, 1);
}
.contact-card-grid {
  width: 100%;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
  padding: 12px;
  background: rgba(245, 245, 245, 0.06);
  border: 3px solid rgba(245, 245, 245, 0.7);
  max-height: 75vh;
  overflow-y: auto;
  overscroll-behavior: contain;
  box-shadow: 0 16px 34px rgba(0, 0, 0, 0.22);
  transition: box-shadow 0.52s ease-out;
}
#contact .contact-grid-layer.is-grid-active .contact-socials {
  filter: blur(0);
  opacity: 1;
  transform: scale(1.02);
}
#contact .contact-grid-layer.is-grid-active .contact-card-grid {
  box-shadow: 0 24px 52px rgba(0, 0, 0, 0.34);
}
.contact-card-grid::-webkit-scrollbar {
  width: 8px;
}
.contact-card-grid::-webkit-scrollbar-thumb {
  background: rgba(245, 245, 245, 0.42);
  border-radius: 999px;
}
.contact-card-grid::-webkit-scrollbar-track {
  background: rgba(245, 245, 245, 0.12);
}
.contact-card {
  position: relative;
  display: block;
  width: 100%;
  text-decoration: none;
  border-radius: 0;
  overflow: hidden;
  background: #121317;
  border: 0;
  box-shadow: none;
  transition: transform 0.24s ease;
}
.contact-card-media {
  position: relative;
  display: block;
  aspect-ratio: 3 / 4;
  overflow: hidden;
}
.contact-card-media .contact-card-label {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 2;
  padding: 4px 8px;
  background: rgba(18, 19, 23, 0.66);
  border: 1px solid rgba(245, 245, 245, 0.38);
  border-radius: 999px;
  font-family: "Inter Tight", sans-serif;
  font-size: 10px;
  letter-spacing: 0.09em;
  text-transform: uppercase;
  color: rgba(245, 245, 245, 0.9);
}
.contact-card img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
  transition: transform 0.26s ease;
}
.contact-image-hover {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0);
  transition: background 0.24s ease;
}
.contact-card-overlay {
  position: relative;
  inset: auto;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: flex-start;
  gap: 6px;
  padding: 12px 12px 13px;
  background: #f5f5f5;
  transition: background 0.24s ease;
  text-align: left;
}
.contact-card-label {
  display: block;
  font-family: "Inter Tight", sans-serif;
  font-size: 11px;
  letter-spacing: 0.02em;
  text-transform: uppercase;
  color: rgba(41, 30, 23, 0.78);
}
.contact-card-title {
  display: inline-flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  font-family: "Inter Tight", sans-serif;
  font-size: 19px;
  font-weight: 600;
  color: #2a2119;
  line-height: 1.05;
}
.contact-card-desc {
  margin-top: 0;
  font-family: "Inter Tight", sans-serif;
  font-size: 13px;
  line-height: 1.35;
  color: rgba(44, 34, 26, 0.82);
}
.contact-card-arrow {
  opacity: 0;
  transform: translateX(-3px);
  transition: opacity 0.22s ease, transform 0.22s ease;
}
.contact-card:hover {
  transform: translateY(-2px);
}
.contact-card:hover .contact-card-overlay {
  background: #f7f7f7;
}
.contact-card:hover .contact-card-arrow {
  opacity: 1;
  transform: translateX(0);
}
.contact-card:hover .contact-image-hover {
  background: rgba(0, 0, 0, 0.46);
}
.contact-card:hover img {
  transform: scale(1.03);
}

#intro {
  position: fixed;
  inset: 0;
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
#intro img {
  width: 120px;
  height: auto;
}

@media (max-width: 768px) {
  header { padding: 20px 24px; }
  .section-content h1 { font-size: 32px; }
  nav a { margin-left: 16px; }
  .brand-pinned-title {
    top: 20px;
    font-size: clamp(13px, 4.6vw, 18px);
  }
  #gallery .section-content { padding-top: 110px; }
  #gallery::before { background-attachment: scroll; }
  .gallery-list { gap: 18px; }
  .gallery-category { border-radius: 14px; }
  .category-cover { height: clamp(230px, 52vw, 300px); }
  .category-overlay { padding: 18px; }
  .category-title { font-size: 23px; }
  .category-subtitle { font-size: 13px; }
  .category-panel { padding: 0 16px; }
  .gallery-category.is-open .category-panel { padding: 18px 16px 22px; }
  .collection-heading { font-size: 28px; }
  .collection-desc { font-size: 14px; }
  .masonry-grid { column-count: 1; }
  .masonry-item { border-radius: 14px; margin-bottom: 22px; }
  #home .layer-fg {
    width: 156%;
    height: 510%;
    background-size: contain;
    left: 50%;
    background-position: center 30%;
  }
  #contact .layer-bg {
    inset: 0;
  }
  #contact .layer-fg1 {
    display: none;
  }
  .about-content-inner {
    width: min(94vw, 620px);
  }
  #about .scene2-strip-bg,
  #about .scene2-strip-fg {
    left: 0;
    width: 124%;
    transform: none;
  }
  #about .scene2-strip-bg {
    background-position: 57% center;
  }
  #about .scene2-strip-fg-image {
    object-position: 57% center;
  }
  .about-heading {
    font-size: clamp(74px, 18vw, 108px);
  }
  .about-slogan {
    font-size: 15px;
    max-width: 420px;
  }
  .about-bio {
    padding: 14px 14px 16px;
  }
  .about-bio h3 {
    font-size: 18px;
  }
  .about-bio p {
    font-size: 15px;
    line-height: 1.65;
  }
  #about.about-selected .section-content {
    top: 50vh;
    transform: translateY(-50%);
  }
  #contact .section-content {
    padding: 106px 24px 58px;
    min-height: 100vh;
  }
  #contact .contact-grid-layer {
    padding-top: 58vh;
  }
  .contact-layout {
    width: min(620px, 100%);
    grid-template-columns: 1fr;
    gap: 20px;
  }
  .contact-intro { padding-top: 0; }
  .contact-socials {
    width: 92vw;
    max-width: 92vw;
    margin: 0;
    padding-right: 0;
  }
  #contact h1 {
    font-size: clamp(74px, 18vw, 108px);
    letter-spacing: -0.01em;
    line-height: 0.86;
    margin-bottom: 12px;
    text-align: left;
  }
  .contact-slogan {
    max-width: 380px;
    font-size: 16px;
    line-height: 1.68;
    margin-bottom: 18px;
  }
  .contact-card-grid {
    width: 100%;
    margin-left: 0;
    grid-template-columns: 1fr;
    gap: 12px;
    padding: 10px;
    max-height: 52vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  .contact-card img { height: 100%; }
  .contact-card-title { font-size: clamp(22px, 8.5vw, 30px); }
  .contact-card-desc { font-size: 14px; }
  section { min-height: 130vh; }
  #contact {
    height: 220vh;
    min-height: 220vh;
  }
}
</style>
</head>
<body>
<div id="intro">
  <img src="assets/logo2.svg" alt="Marvell Florist Logo">
</div>

<header>
  <a href="index.html" aria-label="Go to home page">
    <img src="assets/logo.png" alt="Marvell Florist">
  </a>
  <nav>
    <a href="#home">Home</a>
    <a href="#gallery">Gallery</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
  </nav>
</header>
<div class="brand-pinned-title" aria-hidden="true">Marvell Florist</div>

<section id="home" data-parallax>
  <div class="layer-bg"></div>
  <div class="layer-fg"></div>
  <div class="section-content">
    <h1>Marvell Florist</h1>
    <p>Where every petal is a little more marvelous.</p>
  </div>
</section>

<section id="gallery">
  <div class="section-content">
    <h1>Gallery</h1>
    <p class="gallery-lead">Setiap rangkaian dibuat secara custom dan mengikuti ketersediaan bunga musiman. Tim kami akan mengonfirmasi seluruh detail sebelum pesanan difinalkan.</p>
    <div class="gallery-list" id="gallery-list"></div>
  </div>
</section>

<section id="about" data-parallax>
  <div class="layer-bg scene2-strip-bg"></div>
  <div class="scene2-strip-fg scene2-strip-fg1">
    <img class="scene2-strip-fg-image" src="assets/scene2-fg1.png" data-bio-target="fg1" alt="Tim Kami" role="button" tabindex="0">
  </div>
  <div class="scene2-strip-fg scene2-strip-fg2">
    <img class="scene2-strip-fg-image" src="assets/scene2-fg2.png" data-bio-target="fg2" alt="Karya dan Filosofi" role="button" tabindex="0">
  </div>
  <div class="scene2-strip-fg scene2-strip-fg3">
    <img class="scene2-strip-fg-image" src="assets/scene2-fg3.png" data-bio-target="fg3" alt="Perjalanan dan Perkembangan" role="button" tabindex="0">
  </div>
  <div class="section-content">
    <div class="about-content-inner">
      <h1 class="about-heading">About</h1>
      <p class="about-slogan"><span class="about-slogan-highlight">Discover the people, craft, and journey behind Marvell Florist.</span><br><span class="about-slogan-highlight">Tap a figure to explore each part of our story.</span></p>
      <div class="about-bio-panel" aria-live="polite">
        <article class="about-bio" data-bio="fg2">
          <h3>Karya &amp; Filosofi</h3>
          <p>Sejak 2006, Marvell Florist merangkai bunga untuk berbagai momen tanpa membatasi diri pada satu gaya tertentu. Mulai dari bouquet wisuda, anniversary, papan bunga, hingga kebutuhan personal lainnya, setiap rangkaian dibuat dengan mempertimbangkan konteks, karakter, dan kepuasan pelanggan sebagai prioritas utama.</p>
        </article>
        <article class="about-bio" data-bio="fg3">
          <h3>Perjalanan &amp; Perkembangan</h3>
          <p>Seiring waktu, Marvell Florist terus berkembang dan memperluas jangkauan layanan. Perkembangan ini memungkinkan kami melayani kebutuhan yang lebih luas, baik untuk pelanggan individu maupun pelaku usaha, dengan standar kualitas yang terus dijaga.</p>
        </article>
        <article class="about-bio" data-bio="fg1">
          <h3>Tim Kami</h3>
          <p>Didukung oleh tim yang berpengalaman dan adaptif, kami melayani pemesanan baik secara langsung di toko maupun melalui WhatsApp. Beberapa pesanan dapat diselesaikan pada hari yang sama, tergantung ketersediaan dan kompleksitas desain. Setiap rangkaian dikerjakan dengan perhatian pada detail dan komunikasi yang jelas agar hasil akhir benar-benar sesuai dengan harapan pelanggan.</p>
        </article>
      </div>
    </div>
  </div>
</section>

<section id="contact" data-parallax>
  <div class="parallax-container">
    <div class="layer-bg"></div>
    <div class="contact-grid-layer">
      <div class="contact-socials">
        <div class="contact-card-grid">
      <a class="contact-card" href="https://wa.me/6281275017456" target="_blank" rel="noopener noreferrer">
        <span class="contact-card-media"><img src="assets/whatsapp1.PNG" alt="WhatsApp Primary"><span class="contact-image-hover"></span><span class="contact-card-label">Floral Arrangements</span></span>
        <span class="contact-card-overlay">
          <span class="contact-card-title">WhatsApp (Primary) <span class="contact-card-arrow">&#8594;</span></span>
          <span class="contact-card-desc">Consult custom bouquet and arrangement requests with our primary team.</span>
        </span>
      </a>
      <a class="contact-card" href="https://wa.me/628116667457" target="_blank" rel="noopener noreferrer">
        <span class="contact-card-media"><img src="assets/whatsapp2.PNG" alt="WhatsApp Secondary"><span class="contact-image-hover"></span><span class="contact-card-label">Floral Arrangements</span></span>
        <span class="contact-card-overlay">
          <span class="contact-card-title">WhatsApp (Secondary) <span class="contact-card-arrow">&#8594;</span></span>
          <span class="contact-card-desc">Alternative line for floral inquiries, scheduling, and order follow-up.</span>
        </span>
      </a>
      <a class="contact-card" href="https://wa.me/628116667920" target="_blank" rel="noopener noreferrer">
        <span class="contact-card-media"><img src="assets/whatsapp3.PNG" alt="WhatsApp Supplies"><span class="contact-image-hover"></span><span class="contact-card-label">Supplies</span></span>
        <span class="contact-card-overlay">
          <span class="contact-card-title">WhatsApp Supplies <span class="contact-card-arrow">&#8594;</span></span>
          <span class="contact-card-desc">Reach our supplies desk for florist materials and stock support.</span>
        </span>
      </a>
      <a class="contact-card" href="https://www.instagram.com/marvellflorist" target="_blank" rel="noopener noreferrer">
        <span class="contact-card-media"><img src="assets/instagram.PNG" alt="Instagram"><span class="contact-image-hover"></span><span class="contact-card-label">Instagram</span></span>
        <span class="contact-card-overlay">
          <span class="contact-card-title">@marvellflorist <span class="contact-card-arrow">&#8594;</span></span>
          <span class="contact-card-desc">View recent works, visual references, and latest floral styling updates.</span>
        </span>
      </a>
      <a class="contact-card" href="https://maps.app.goo.gl/PL8EQ7C1mVJAoa3LA?g_st=ic" target="_blank" rel="noopener noreferrer">
        <span class="contact-card-media"><img src="assets/location1.jpg" alt="Lokasi Rangkaian Bunga"><span class="contact-image-hover"></span><span class="contact-card-label">Locations</span></span>
        <span class="contact-card-overlay">
          <span class="contact-card-title">Lokasi (Rangkaian Bunga) <span class="contact-card-arrow">&#8594;</span></span>
          <span class="contact-card-desc">Visit our floral arrangement location for consultations and pickups.</span>
        </span>
      </a>
      <a class="contact-card" href="https://maps.app.goo.gl/uhXFdFr4SfC97ABb9?g_st=ic" target="_blank" rel="noopener noreferrer">
        <span class="contact-card-media"><img src="assets/location2.jpg" alt="Lokasi Supplies"><span class="contact-image-hover"></span><span class="contact-card-label">Locations</span></span>
        <span class="contact-card-overlay">
          <span class="contact-card-title">Lokasi (Supplies) <span class="contact-card-arrow">&#8594;</span></span>
          <span class="contact-card-desc">Store location for florist supplies, supporting materials, and essentials.</span>
        </span>
      </a>
        </div>
      </div>
    </div>
    <div class="layer-fg layer-fg-curtain layer-fg1 scene4FG1"></div>
    <div class="layer-fg layer-fg-people layer-fg2 scene4FG2"></div>
  </div>
  <div class="section-content">
    <div class="contact-layout">
      <div class="contact-intro">
        <h1>Contact</h1>
        <p class="contact-slogan"><span class="contact-slogan-highlight">Reach us for floral consultations and tailored supplies support.</span><br><span class="contact-slogan-highlight">Every request is confirmed with our team before production.</span></p>
      </div>
    </div>
  </div>
</section>

<script>
const sections = document.querySelectorAll("section[data-parallax]");
const state = new Map();
sections.forEach((section) => {
  state.set(section, {
    bg: 0,
    fg: 0,
    aboutFg1: 0,
    aboutFg2: 0,
    aboutFg3: 0,
    fgCurtain: 0,
    fgCurtainX: 0,
    fgPeople: 0,
    mouseX: 0,
    mouseY: 0,
    mouseTargetX: 0,
    mouseTargetY: 0
  });
});

function lerp(a, b, t) {
  return a + (b - a) * t;
}

function clamp(value, min, max) {
  return Math.min(Math.max(value, min), max);
}

const gallerySection = document.getElementById("gallery");
const galleryList = document.getElementById("gallery-list");
let galleryCategories = [];

const galleryCategoryMeta = [
  {
    name: "Artificial Flowers",
    subtitle: "Rangkaian bunga artifisial untuk kebutuhan dekoratif dan penggunaan jangka panjang.",
    phone: "6281275017456"
  },
  {
    name: "Bouquets",
    subtitle: "Bouquet custom untuk hadiah, perayaan, dan momen spesial.",
    phone: "6281275017456"
  },
  {
    name: "Dekorasi Mobil",
    subtitle: "Dekorasi bunga mobil untuk pernikahan, event, dan kebutuhan seremonial.",
    phone: "6281275017456"
  },
  {
    name: "Papan Bunga",
    subtitle: "Papan bunga ucapan untuk peresmian, duka cita, dan momen formal lainnya.",
    phone: "6281275017456"
  },
  {
    name: "Pita Peresmian",
    subtitle: "Pita peresmian untuk acara grand opening dan kegiatan seremonial.",
    phone: "6281275017456"
  },
  {
    name: "Standing Flowers",
    subtitle: "Standing flowers untuk dekorasi acara dan kebutuhan display formal.",
    phone: "6281275017456"
  },
  {
    name: "Supplies",
    subtitle: "Kebutuhan florist, bahan pendukung, dan perlengkapan dekorasi.",
    phone: "628116667920"
  }
];

function escapeHTML(value) {
  return String(value ?? "")
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/\"/g, "&quot;")
    .replace(/'/g, "&#39;");
}

function formatRupiah(value) {
  const numeric = Number(String(value ?? "").replace(/[^\d.-]/g, ""));
  if (!Number.isFinite(numeric)) return "Rp -";
  return `Rp ${new Intl.NumberFormat("id-ID").format(Math.round(numeric))}`;
}

function buildConsultHref(phone, text) {
  return `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
}

function renderGalleryFromData(data) {
  if (!galleryList) return;
  const items = Array.isArray(data?.items) ? data.items : [];
  const grouped = new Map();
  galleryCategoryMeta.forEach((meta) => grouped.set(meta.name, []));

  items.forEach((item) => {
    if (!item || typeof item !== "object") return;
    const normalizedCategory = galleryCategoryMeta.find((meta) => meta.name === item.category)?.name;
    if (!normalizedCategory) return;
    grouped.get(normalizedCategory).push(item);
  });

  const categoryMarkup = galleryCategoryMeta.map((meta) => {
    const categoryItems = grouped.get(meta.name) || [];
    const cover = categoryItems.find((entry) => entry.image)?.image || "";

    const masonry = categoryItems.length
      ? categoryItems.map((item) => {
        const safeName = escapeHTML(item.name || "Produk");
        const safePrice = formatRupiah(item.price);
        const safeImage = escapeHTML(item.image || "");
        const consultText = `Halo, saya ingin konsultasi desain ${item.name || "produk"} dengan harga ${safePrice} pada kategori ${meta.name}.`;
        const consultHref = buildConsultHref(meta.phone, consultText);
        return `
            <div class="masonry-item">
              <img src="${safeImage}" alt="${safeName}" loading="lazy">
              <div class="design-overlay">
                <p class="design-title">${safeName}</p>
                <p class="design-title">${safePrice}</p>
                <a class="design-consult-btn" href="${consultHref}" target="_blank" rel="noopener noreferrer">Konsultasi Desain Ini</a>
              </div>
            </div>
        `;
      }).join("")
      : '<div class="collection-placeholder">This collection will be updated soon.</div>';

    const collectionConsult = buildConsultHref(
      meta.phone,
      `Halo, saya ingin konsultasi koleksi: ${meta.name}`
    );

    return `
      <article class="gallery-category">
        <button class="category-toggle" type="button">
          <div class="category-cover">
            ${cover ? `<img src="${escapeHTML(cover)}" alt="${escapeHTML(meta.name)} cover" loading="lazy">` : '<div class="category-cover-placeholder" aria-hidden="true"></div>'}
            <div class="category-overlay">
              <p class="category-title">${escapeHTML(meta.name)}</p>
              <p class="category-subtitle">${escapeHTML(meta.subtitle)}</p>
              <span class="category-expand-label">View Collection</span>
            </div>
          </div>
        </button>
        <div class="category-panel">
          <h2 class="collection-heading">${escapeHTML(meta.name)} Collection</h2>
          <p class="collection-desc">${escapeHTML(meta.subtitle)}</p>
          <div class="masonry-grid">
            ${masonry}
          </div>
          <div class="category-consult-wrap">
            <a class="category-consult-btn" href="${collectionConsult}" target="_blank" rel="noopener noreferrer">Konsultasi Koleksi Ini</a>
          </div>
        </div>
      </article>
    `;
  }).join("");

  galleryList.innerHTML = categoryMarkup;
  galleryCategories = Array.from(galleryList.querySelectorAll(".gallery-category"));
}

if (window.matchMedia("(pointer: fine)").matches) {
  sections.forEach((section) => {
    section.addEventListener("mousemove", (event) => {
      const rect = section.getBoundingClientRect();
      const nx = clamp(((event.clientX - rect.left) / rect.width) * 2 - 1, -1, 1);
      const ny = clamp(((event.clientY - rect.top) / rect.height) * 2 - 1, -1, 1);
      const current = state.get(section);
      if (!current) return;
      if (section.id === "home") {
        const deadZone = 0.06;
        const nxAbs = Math.abs(nx);
        const nyAbs = Math.abs(ny);
        const nxNorm = nxAbs <= deadZone ? 0 : (nxAbs - deadZone) / (1 - deadZone);
        const nyNorm = nyAbs <= deadZone ? 0 : (nyAbs - deadZone) / (1 - deadZone);
        const edgeCurveX = Math.pow(nxNorm, 1.85);
        const edgeCurveY = Math.pow(nyNorm, 1.85);
        // Invert direction so layers move opposite to cursor.
        current.mouseTargetX = -Math.sign(nx) * edgeCurveX * 28;
        current.mouseTargetY = -Math.sign(ny) * edgeCurveY * 19;
      } else {
        current.mouseTargetX = nx * 28;
        current.mouseTargetY = ny * 20;
      }
    });

    section.addEventListener("mouseleave", () => {
      const current = state.get(section);
      if (!current) return;
      current.mouseTargetX = 0;
      current.mouseTargetY = 0;
    });
  });
}

function getOpenPanelHeight() {
  if (window.innerWidth <= 768) {
    return Math.round(Math.min(520, Math.max(340, window.innerHeight * 0.58)));
  }
  return Math.round(Math.min(760, Math.max(480, window.innerHeight * 0.68)));
}

function updateGalleryOpenState() {
  const hasOpen = Array.from(galleryCategories).some((item) => item.classList.contains("is-open"));
  let isGalleryInView = false;
  if (gallerySection) {
    const rect = gallerySection.getBoundingClientRect();
    isGalleryInView = rect.top < window.innerHeight * 0.6 && rect.bottom > window.innerHeight * 0.4;
  }
  document.body.classList.toggle("gallery-open", hasOpen && isGalleryInView);
}

function initializeGalleryInteractions() {
  galleryCategories.forEach((category, index) => {
    const toggle = category.querySelector(".category-toggle");
    const panel = category.querySelector(".category-panel");
    if (!toggle || !panel) return;

    const panelId = `gallery-panel-${index + 1}`;
    panel.id = panelId;
    toggle.setAttribute("aria-controls", panelId);
    toggle.setAttribute("aria-expanded", "false");
    panel.style.maxHeight = "0px";

    toggle.addEventListener("click", () => {
      const isOpen = category.classList.contains("is-open");

      galleryCategories.forEach((item) => {
        const itemToggle = item.querySelector(".category-toggle");
        const itemPanel = item.querySelector(".category-panel");
        const activeItems = item.querySelectorAll(".masonry-item.is-active");
        item.classList.remove("is-open");
        if (itemToggle) itemToggle.setAttribute("aria-expanded", "false");
        if (itemPanel) itemPanel.style.maxHeight = "0px";
        activeItems.forEach((active) => active.classList.remove("is-active"));
      });

      if (!isOpen) {
        category.classList.add("is-open");
        toggle.setAttribute("aria-expanded", "true");
        requestAnimationFrame(() => {
          const targetHeight = Math.min(panel.scrollHeight, getOpenPanelHeight());
          panel.style.maxHeight = `${targetHeight}px`;
        });
      }

      updateGalleryOpenState();
    });
  });

  window.addEventListener("resize", () => {
    galleryCategories.forEach((category) => {
      const panel = category.querySelector(".category-panel");
      if (!panel) return;
      if (category.classList.contains("is-open")) {
        const targetHeight = Math.min(panel.scrollHeight, getOpenPanelHeight());
        panel.style.maxHeight = `${targetHeight}px`;
      }
    });
    updateGalleryOpenState();
  });

  window.addEventListener("scroll", updateGalleryOpenState, { passive: true });

  if (gallerySection) {
    const masonryItems = gallerySection.querySelectorAll(".masonry-item");
    masonryItems.forEach((item) => {
      item.addEventListener("click", (event) => {
        const target = event.target;
        if (!(target instanceof HTMLElement)) return;
        if (target.closest(".design-consult-btn")) return;

        const isMobile = window.matchMedia("(max-width: 768px)").matches;
        if (!isMobile) return;

        event.preventDefault();
        const panel = item.closest(".category-panel");
        if (!panel) return;

        panel.querySelectorAll(".masonry-item.is-active").forEach((active) => {
          if (active !== item) active.classList.remove("is-active");
        });
        item.classList.toggle("is-active");
      });
    });

    document.addEventListener("click", (event) => {
      const target = event.target;
      if (!(target instanceof HTMLElement)) return;
      if (target.closest(".masonry-item")) return;
      gallerySection.querySelectorAll(".masonry-item.is-active").forEach((item) => {
        item.classList.remove("is-active");
      });
    });
  }

  const canHoverPreview = window.matchMedia("(hover: hover) and (pointer: fine)").matches;
  const previewTimers = new WeakMap();
  if (canHoverPreview) {
    galleryCategories.forEach((category) => {
      const coverImage = category.querySelector(".category-cover img");
      const panelImages = Array.from(category.querySelectorAll(".masonry-grid img"));
      if (!coverImage) return;

      const frames = Array.from(
        new Set([
          coverImage.getAttribute("src"),
          ...panelImages.map((img) => img.getAttribute("src"))
        ].filter(Boolean))
      ).slice(0, 5);

      if (frames.length < 2) return;
      let frameIndex = 0;
      let fadeTimer = null;

      const renderFrame = (index, immediate = false) => {
        if (fadeTimer) window.clearTimeout(fadeTimer);
        if (immediate) {
          coverImage.classList.remove("is-fading");
          coverImage.setAttribute("src", frames[index]);
          return;
        }
        coverImage.classList.add("is-fading");
        fadeTimer = window.setTimeout(() => {
          coverImage.setAttribute("src", frames[index]);
          coverImage.classList.remove("is-fading");
        }, 180);
      };

      const stopPreview = () => {
        const timer = previewTimers.get(category);
        if (timer) {
          window.clearInterval(timer);
          previewTimers.delete(category);
        }
        frameIndex = 0;
        renderFrame(0, false);
      };

      const startPreview = () => {
        if (previewTimers.get(category)) return;
        const timer = window.setInterval(() => {
          frameIndex = (frameIndex + 1) % frames.length;
          renderFrame(frameIndex, false);
        }, 1750);
        previewTimers.set(category, timer);
      };

      category.addEventListener("mouseenter", startPreview);
      category.addEventListener("mouseleave", stopPreview);
      category.addEventListener("focusin", startPreview);
      category.addEventListener("focusout", () => {
        requestAnimationFrame(() => {
          const active = document.activeElement;
          if (!(active instanceof HTMLElement) || !category.contains(active)) {
            stopPreview();
          }
        });
      });
    });
  }

  updateGalleryOpenState();
}

async function initializeGallery() {
  try {
    const response = await fetch("/data/gallery.json", { cache: "no-store" });
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    const payload = await response.json();
    renderGalleryFromData(payload);
  } catch (error) {
    renderGalleryFromData({ items: [] });
  }
  initializeGalleryInteractions();
}

initializeGallery();

const aboutSection = document.getElementById("about");
const aboutFigures = aboutSection ? Array.from(aboutSection.querySelectorAll(".scene2-strip-fg-image[data-bio-target]")) : [];
const aboutBios = aboutSection ? Array.from(aboutSection.querySelectorAll(".about-bio")) : [];
const aboutBioPanel = aboutSection ? aboutSection.querySelector(".about-bio-panel") : null;
const aboutPixelSamplers = new WeakMap();
const aboutHoverOrder = ["fg3", "fg2", "fg1"];

function setAboutActiveBio(targetKey, shouldScroll = false, forceState = false) {
  if (!aboutSection) return;
  const currentKey = aboutSection.dataset.activeBio || "";
  const nextKey = forceState ? targetKey : (currentKey === targetKey ? "" : targetKey);
  aboutSection.dataset.activeBio = nextKey;
  aboutSection.classList.toggle("about-selected", Boolean(nextKey));

  aboutFigures.forEach((figure) => {
    const isActive = figure.dataset.bioTarget === nextKey;
    figure.classList.toggle("is-active", isActive);
    figure.classList.toggle("is-dim", Boolean(nextKey) && !isActive);
    figure.setAttribute("aria-pressed", isActive ? "true" : "false");
  });

  aboutBios.forEach((bio) => {
    bio.classList.toggle("is-active", bio.dataset.bio === nextKey);
  });

  if (nextKey && shouldScroll && window.matchMedia("(max-width: 768px)").matches && aboutBioPanel) {
    aboutBioPanel.scrollIntoView({ behavior: "smooth", block: "center" });
  }
}

function preparePixelSampler(imgElement) {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d", { willReadFrequently: true });
  if (!ctx) return;
  const source = new Image();
  let ready = false;

  source.crossOrigin = "anonymous";
  source.src = imgElement.currentSrc || imgElement.src;

  source.onload = () => {
    canvas.width = source.naturalWidth || source.width;
    canvas.height = source.naturalHeight || source.height;
    if (!canvas.width || !canvas.height) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(source, 0, 0);
    ready = true;
  };

  const sampleAlpha = (clientX, clientY) => {
    if (!ready || !canvas.width || !canvas.height) return 0;
    const rect = imgElement.getBoundingClientRect();
    if (!rect.width || !rect.height) return 0;
    const rawX = (clientX - rect.left) * (canvas.width / rect.width);
    const rawY = (clientY - rect.top) * (canvas.height / rect.height);
    const x = Math.max(0, Math.min(canvas.width - 1, Math.floor(rawX)));
    const y = Math.max(0, Math.min(canvas.height - 1, Math.floor(rawY)));
    return ctx.getImageData(x, y, 1, 1).data[3];
  };
  aboutPixelSamplers.set(imgElement, sampleAlpha);
}

function enterAboutFigure(imgElement) {
  imgElement.classList.add("is-pixel-hover");
}

function leaveAboutFigure(imgElement) {
  imgElement.classList.remove("is-pixel-hover");
}

aboutFigures.forEach((figure) => {
  preparePixelSampler(figure);

  figure.addEventListener("keydown", (event) => {
    if (event.key !== "Enter" && event.key !== " ") return;
    event.preventDefault();
    const targetKey = figure.dataset.bioTarget;
    if (!targetKey) return;
    setAboutActiveBio(targetKey, true);
  });
});

function getTopAboutFigureAt(clientX, clientY) {
  const ordered = aboutHoverOrder
    .map((target) => aboutFigures.find((figure) => figure.dataset.bioTarget === target))
    .filter(Boolean);
  for (const figure of ordered) {
    const sample = aboutPixelSamplers.get(figure);
    if (!sample) continue;
    if (sample(clientX, clientY) > 10) return figure;
  }
  return null;
}

if (aboutSection) {
  let currentHoveredFigure = null;
  const isDesktopPointer = window.matchMedia("(hover: hover) and (pointer: fine)").matches;

  aboutSection.addEventListener("mousemove", (event) => {
    const activeFigure = getTopAboutFigureAt(event.clientX, event.clientY);
    currentHoveredFigure = activeFigure;
    aboutFigures.forEach((figure) => {
      if (figure === activeFigure) enterAboutFigure(figure);
      else leaveAboutFigure(figure);
    });
    if (isDesktopPointer) {
      const targetKey = activeFigure ? activeFigure.dataset.bioTarget : "";
      if (targetKey) setAboutActiveBio(targetKey, false, true);
      else setAboutActiveBio("", false, true);
    }
  });

  aboutSection.addEventListener("mouseleave", () => {
    currentHoveredFigure = null;
    aboutFigures.forEach((figure) => leaveAboutFigure(figure));
    if (isDesktopPointer) setAboutActiveBio("", false, true);
  });

  aboutSection.addEventListener("click", (event) => {
    if (isDesktopPointer) return;
    // Use the same resolved hover target so click area matches hover area 1:1.
    const activeFigure = currentHoveredFigure || getTopAboutFigureAt(event.clientX, event.clientY);
    if (!activeFigure) {
      const target = event.target;
      if (target instanceof HTMLElement && target.closest(".section-content")) return;
      return;
    }
    const targetKey = activeFigure.dataset.bioTarget;
    if (!targetKey) return;
    setAboutActiveBio(targetKey, true);
  });
}

const contactGridLayer = document.querySelector("#contact .contact-grid-layer");
const contactSocials = document.querySelector("#contact .contact-socials");
let homePinnedState = false;
let contactGridExitTimer = null;
if (contactGridLayer && contactSocials) {
  const activateGrid = () => {
    if (contactGridExitTimer) window.clearTimeout(contactGridExitTimer);
    contactGridLayer.classList.add("is-grid-elevated");
    contactGridLayer.classList.add("is-grid-active");
  };

  const deactivateGrid = () => {
    contactGridLayer.classList.remove("is-grid-active");
    if (contactGridExitTimer) window.clearTimeout(contactGridExitTimer);
    contactGridExitTimer = window.setTimeout(() => {
      contactGridLayer.classList.remove("is-grid-elevated");
    }, 740);
  };

  contactSocials.addEventListener("mouseenter", activateGrid);
  contactSocials.addEventListener("mouseleave", deactivateGrid);
  contactSocials.addEventListener("focusin", activateGrid);
  contactSocials.addEventListener("focusout", () => {
    requestAnimationFrame(() => {
      const active = document.activeElement;
      if (!(active instanceof HTMLElement) || !contactSocials.contains(active)) {
        deactivateGrid();
      }
    });
  });
}

function animate() {
  const isMobile = window.matchMedia("(max-width: 768px)").matches;
  let shouldPinHomeTitle = false;

  sections.forEach((section) => {
    const travel = Math.max(section.offsetHeight - window.innerHeight, 1);
    const progress = clamp((window.scrollY - section.offsetTop) / travel, 0, 1);
    const bg = section.querySelector(".layer-bg");
    const fg = section.querySelector(".layer-fg");
    const fgCurtain = section.querySelector(".layer-fg-curtain");
    const fgPeople = section.querySelector(".layer-fg-people");
    const current = state.get(section);

    const isContact = section.id === "contact";
    let bgTarget = progress * (isMobile ? -72 : -120);
    let fgRange = 360;

    if (section.id === "home" && fg) {
      const maxSafeTravel = Math.max((fg.offsetHeight - section.offsetHeight) / 2, 0);
      fgRange = isMobile ? Math.max(0, Math.min(78, maxSafeTravel * 0.34)) : clamp(maxSafeTravel, 300, 760);
    } else if (isMobile && fg) {
      const maxSafeTravel = Math.max((fg.offsetHeight - section.offsetHeight) / 2, 0);
      const desiredRange = 75;
      fgRange = Math.min(desiredRange, maxSafeTravel * 0.3);
    }

    const fgTarget = progress * -fgRange;
    if (isContact && bg) {
      const bgMaxScale = isMobile ? 1.035 : 1.045;
      const bgSafeTravel = Math.max((bg.offsetHeight * bgMaxScale - section.offsetHeight) / 2, 0);
      const bgDesiredRange = isMobile ? 14 : 22;
      bgTarget = progress * -Math.min(bgDesiredRange, bgSafeTravel);
    }

    current.bg = lerp(current.bg, bgTarget, isContact ? 0.032 : 0.08);
    const fgLerp = isMobile ? 0.042 : (section.id === "home" ? 0.11 : 0.06);
    current.fg = lerp(current.fg, fgTarget, fgLerp);

    const allowMouseDepth = !isMobile && window.matchMedia("(pointer: fine)").matches && section.id === "home";
    const targetMouseX = allowMouseDepth ? current.mouseTargetX : 0;
    const targetMouseY = allowMouseDepth ? current.mouseTargetY : 0;
    const mouseLerp = section.id === "home" ? 0.08 : 0.12;
    current.mouseX = lerp(current.mouseX, targetMouseX, mouseLerp);
    current.mouseY = lerp(current.mouseY, targetMouseY, mouseLerp);

    if (bg) {
      if (section.id === "about") {
        bg.style.transform = "none";
      } else if (isContact) {
        const bgScale = isMobile ? 1.035 : 1.045;
        bg.style.transform = `translateY(${current.bg}px) scale(${bgScale})`;
      } else {
        const bgX = allowMouseDepth ? current.mouseX : 0;
        const bgY = allowMouseDepth ? current.mouseY : 0;
        if (section.id === "home") {
          const rotateY = allowMouseDepth ? clamp(bgX / 24, -1.6, 1.6) : 0;
          const rotateX = allowMouseDepth ? clamp(-bgY / 28, -1.3, 1.3) : 0;
          bg.style.transform = `perspective(1200px) translate3d(${bgX}px, ${current.bg + bgY}px, 0) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
        } else {
          bg.style.transform = `translate3d(${bgX}px, ${current.bg + bgY}px, 0)`;
        }
      }
    }

    if (isContact && fgCurtain && fgPeople) {
      const curtainScale = 1.01 + progress * (isMobile ? 0.012 : 0.016);
      const fg2Progress = clamp(progress / 0.5, 0, 1);
      const peopleStartScale = isMobile ? 1.18 : 1.24;
      const peopleBaseY = isMobile ? 18 : 30;
      const peopleScale = peopleStartScale;
      const curtainSafeTravel = Math.max((fgCurtain.offsetHeight * curtainScale - section.offsetHeight) / 2, 0);
      const peopleSafeTravel = Math.max((fgPeople.offsetHeight * peopleStartScale - section.offsetHeight) / 2, 0);
      const curtainDesiredRange = isMobile ? 52 : 96;
      const peopleDesiredRange = isMobile ? 56 : 102;
      const curtainRange = Math.min(curtainDesiredRange, curtainSafeTravel);
      const peopleRange = Math.min(peopleDesiredRange, peopleSafeTravel);
      const curtainBaseY = isMobile ? 10 : 14;
      const curtainBaseX = isMobile ? -34 : -58;
      const curtainXRange = 0;

      const curtainTarget = progress * curtainRange;
      const curtainTargetX = progress * curtainXRange;
      const peopleTarget = fg2Progress * -peopleRange;
      current.fgCurtain = lerp(current.fgCurtain, curtainTarget, isMobile ? 0.038 : 0.048);
      current.fgCurtainX = lerp(current.fgCurtainX, curtainTargetX, isMobile ? 0.044 : 0.056);
      current.fgPeople = lerp(current.fgPeople, peopleTarget, isMobile ? 0.086 : 0.11);

      fgCurtain.style.transform = `translate3d(${curtainBaseX + current.fgCurtainX}px, ${curtainBaseY + current.fgCurtain}px, 0) scale(${curtainScale})`;
      fgPeople.style.transform = `translateY(${peopleBaseY + current.fgPeople}px) scale(${peopleScale})`;
    } else if (fg) {
      const baseFgOffset = isMobile
        ? (section.id === "home" ? -33 : (section.id === "about" ? -24 : -37))
        : (section.id === "home" ? -20 : -50);
      const fgMouseStrength = section.id === "home" ? 0.58 : 0.78;
      const fgMouseX = allowMouseDepth ? current.mouseX * fgMouseStrength : 0;
      const fgMouseY = allowMouseDepth ? current.mouseY * fgMouseStrength : 0;
      if (section.id === "home") {
        const fgRotateY = allowMouseDepth ? clamp(fgMouseX / 20, -1.35, 1.35) : 0;
        const fgRotateX = allowMouseDepth ? clamp(-fgMouseY / 22, -1.15, 1.15) : 0;
        fg.style.transform = `perspective(1200px) translate(calc(-50% + ${fgMouseX}px), calc(${baseFgOffset}% + ${current.fg + fgMouseY}px)) rotateX(${fgRotateX}deg) rotateY(${fgRotateY}deg)`;
      } else {
        fg.style.transform = `translate(calc(-50% + ${fgMouseX}px), calc(${baseFgOffset}% + ${current.fg + fgMouseY}px))`;
      }
    }

    if (section.id === "contact") {
      const contactActive = window.scrollY + window.innerHeight * 0.7 > section.offsetTop
        && window.scrollY < section.offsetTop + section.offsetHeight;
      section.classList.toggle("is-visible", contactActive);
    }
    if (section.id === "home") {
      const homeTitle = section.querySelector(".section-content h1");
      if (homeTitle) {
        const titleTop = homeTitle.getBoundingClientRect().top;
        if (!homePinnedState && titleTop <= 86) homePinnedState = true;
        if (homePinnedState && titleTop >= 132) homePinnedState = false;
        shouldPinHomeTitle = homePinnedState;
      } else {
        shouldPinHomeTitle = homePinnedState;
      }
    }
  });
  document.body.classList.toggle("home-title-pinned", shouldPinHomeTitle);

  requestAnimationFrame(animate);
}

animate();

window.addEventListener("load", () => {
  const intro = document.getElementById("intro");
  if (!intro) return;
  setTimeout(() => {
    intro.style.transition = "opacity 1s ease";
    intro.style.opacity = "0";
    setTimeout(() => intro.remove(), 1000);
  }, 1800);
});
</script>
</body>
</html>
